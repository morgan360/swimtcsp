{% load static %}
{% load group_filters %}

<nav class="navbar is-white has-shadow" role="navigation" aria-label="main navigation" x-data="{ mobileOpen: false }">
  <div class="navbar-brand">
    <a class="navbar-item" href="/">
      <img src="{% static 'img/logo.png' %}" alt="Logo" width="40" height="40">
      <strong class="ml-2">TCSP</strong>
    </a>

    <button 
      class="navbar-burger" 
      :class="{ 'is-active': mobileOpen }"
      @click="mobileOpen = !mobileOpen"
      aria-label="menu" 
      aria-expanded="false">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </button>
  </div>

  <div class="navbar-menu" :class="{ 'is-active': mobileOpen }">
    <div class="navbar-start">
      <!-- Home Link -->
      <a href="/" class="navbar-item" @click="mobileOpen = false">
        Home
      </a>

      <!-- Swimming Programs -->
      {% if user.is_authenticated and user|is_customer_user %}
        <a href="{% url 'swims:product_list' %}" class="navbar-item" @click="mobileOpen = false">
          Public Swims
        </a>
      {% endif %}

      <!-- Swimming Lessons for Guardians -->
      {% if user|is_guardian_user %}
        <div class="navbar-item has-dropdown" x-data="{ dropdownOpen: false }" @click.away="dropdownOpen = false">
          <a class="navbar-link" @click="dropdownOpen = !dropdownOpen">
            Swimming Lessons
          </a>
          <div class="navbar-dropdown" x-show="dropdownOpen" x-transition>
            <a href="/lessons/lesson_list" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
              Public Lessons
            </a>
            <a href="{% url 'users:combined_swimling_mgmt' %}" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
              Swimling Panel
            </a>
            <a href="/lessons_bookings/booking_history/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
              Booking History
            </a>
          </div>
        </div>
      {% endif %}

      <!-- School Programs -->
      {% if user|is_school_user %}
        <div class="navbar-item has-dropdown" x-data="{ dropdownOpen: false }" @click.away="dropdownOpen = false">
          <a class="navbar-link" @click="dropdownOpen = !dropdownOpen">
            School Programs
          </a>
          <div class="navbar-dropdown" x-show="dropdownOpen" x-transition>
            <a href="/schools/school_list" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
              School Bookings
            </a>
            <a href="/school/register/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
              Register School
            </a>
            <a href="/schools/school_dashboard/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
              School Dashboard
            </a>
          </div>
        </div>
      {% endif %}

      <!-- Programs Menu for Non-authenticated users -->
      {% if not user.is_authenticated %}
        <div class="navbar-item has-dropdown" x-data="{ dropdownOpen: false }" @click.away="dropdownOpen = false">
          <a class="navbar-link" @click="dropdownOpen = !dropdownOpen">
            Programs
          </a>
          <div class="navbar-dropdown" x-show="dropdownOpen" x-transition>
            <a href="{% url 'swims:product_list' %}" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
              Public Swims
            </a>
            <a href="/lessons/lesson_list" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
              Swimming Lessons
            </a>
            <a href="/schools/school_list" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
              School Programs
            </a>
          </div>
        </div>
      {% endif %}

      <!-- About -->
      <a href="{% url 'about' %}" class="navbar-item" @click="mobileOpen = false">
        About
      </a>

      <!-- Contact -->
      <a href="{% url 'contact' %}" class="navbar-item" @click="mobileOpen = false">
        Contact
      </a>
    </div>

    <div class="navbar-end">
      {% if user.is_authenticated %}
        <!-- User Account Menu -->
        <div class="navbar-item has-dropdown" x-data="{ dropdownOpen: false }" @click.away="dropdownOpen = false">
          <a class="navbar-link" @click="dropdownOpen = !dropdownOpen">
            My Account
          </a>
          <div class="navbar-dropdown is-right" x-show="dropdownOpen" x-transition>
            <a href="{% url 'users:profile' %}" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
              Profile
            </a>
            {% if user|is_guardian_user %}
              <a href="{% url 'users:combined_swimling_mgmt' %}" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                Swim Center
              </a>
              <a href="/lessons_bookings/booking_history/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                My Bookings
              </a>
            {% endif %}
            {% if user|is_customer_user %}
              <a href="/swims/my_bookings/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                My Swim Bookings
              </a>
            {% endif %}
            {% if user|is_school_user %}
              <a href="/schools/school_dashboard/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                School Dashboard
              </a>
            {% endif %}
            <a href="/account/password/change/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
              Change Password
            </a>
            <hr class="navbar-divider">
            <a href="{% url 'account_logout' %}" class="navbar-item has-text-danger" @click="mobileOpen = false; dropdownOpen = false">
              Logout
            </a>
          </div>
        </div>

        <!-- Admin/Staff Management Menu -->
        {% if user|is_admin_user %}
          <div class="navbar-item has-dropdown" x-data="{ dropdownOpen: false }" @click.away="dropdownOpen = false">
            <a class="navbar-link" @click="dropdownOpen = !dropdownOpen">
              Management
            </a>
            <div class="navbar-dropdown is-right" x-show="dropdownOpen" x-transition>
              <a href="/admin/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                Admin Panel
              </a>
              <a href="/lessons_bookings/management/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                Booking Management
              </a>
              <a href="{% url 'term_information' %}" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                Analytics
              </a>
              <hr class="navbar-divider">
              <a href="/staff/schedule/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                Staff Schedule
              </a>
              <a href="/reports/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                Reports
              </a>
              <a href="/settings/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                Settings
              </a>
            </div>
          </div>
        {% endif %}

        <!-- Staff Menu (for staff but not admin) -->
        {% if user.is_staff and not user|is_admin_user %}
          <div class="navbar-item has-dropdown" x-data="{ dropdownOpen: false }" @click.away="dropdownOpen = false">
            <a class="navbar-link" @click="dropdownOpen = !dropdownOpen">
              Staff
            </a>
            <div class="navbar-dropdown is-right" x-show="dropdownOpen" x-transition>
              <a href="/staff/dashboard/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                Staff Dashboard
              </a>
              <a href="/staff/schedule/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                My Schedule
              </a>
              <a href="/lessons_bookings/management/" class="navbar-item" @click="mobileOpen = false; dropdownOpen = false">
                Manage Bookings
              </a>
            </div>
          </div>
        {% endif %}

      {% else %}
        <!-- Authentication Links for Non-authenticated users -->
        <div class="navbar-item">
          <div class="buttons">
            <a href="{% url 'account_signup' %}" class="button is-primary" @click="mobileOpen = false">
              <strong>Sign up</strong>
            </a>
            <a href="{% url 'account_login' %}" class="button is-light" @click="mobileOpen = false">
              Log in
            </a>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</nav>